"use strict";(self["webpackChunkuniversity_crm"]=self["webpackChunkuniversity_crm"]||[]).push([[983],{983:function(e,t,s){s.r(t),s.d(t,{default:function(){return re}});var a=s(3396),i=s(7139),l=s(9242);const n={class:"position-relative"},o={class:"outsideEditor"},r={id:"toBar",style:{position:"absolute","z-index":"2"},class:"bg-light shadow-sm w-100 px-4 pt-2"},c={class:"text-dark w-100"},d={key:0,class:"ms-2 text-secondary"},u={ref:"chatContainer",class:"overflow",style:{"overflow-y":"auto",height:"87vh","padding-bottom":"160px"}},h=(0,a._)("br",null,null,-1),p={key:0,class:"line-middle position-relative my-3"},m={class:"display-inline-block px-3 d-flex py-2 badge rounded-pill bg-white",style:{border:"1px solid #ccc"}},g={class:"time"},y={class:"d-flex gutter-x"},_={key:0,class:"me-2"},f=["src"],v={key:1,class:"me-2",style:{width:"36px"}},b={style:{"margin-top":"-5px"}},w={class:"me-2 tName"},D={class:"time"},x=["innerHTML"],k={key:0},q=["src"],T={class:"row w-100",style:{position:"absolute",bottom:"8px",transition:"bottom 0.3s cubic-bezier(0.55, 0.53, 0.68, 1.26) 0s"}},I={class:"message-input-wrapper"},C={class:"input-area"},S={class:"position-relative w-100",style:{bottom:"-"}},E={class:"ql-toolbar"},$=(0,a._)("span",{class:"ql-formats"},[(0,a._)("button",{class:"ql-bold"}),(0,a._)("button",{class:"ql-italic"}),(0,a._)("button",{class:"ql-underline"}),(0,a._)("button",{class:"ql-strike"})],-1),M=(0,a._)("span",{class:"ql-formats"},[(0,a._)("button",{class:"ql-blockquote"}),(0,a._)("button",{class:"ql-code-block"}),(0,a._)("button",{class:"ql-list",value:"ordered"}),(0,a._)("button",{class:"ql-list",value:"bullet"}),(0,a._)("button",{class:"ql-script",value:"sub"}),(0,a._)("button",{class:"ql-script",value:"super"}),(0,a._)("button",{class:"ql-clean"})],-1),L={class:"file-label"},H={class:"file-button"},A={xmlns:"http://www.w3.org/2000/svg",width:"100",style:{width:"20px"},viewBox:"0 0 100 100",id:"attachment"},N=(0,a._)("path",{fill:"#555",d:"M18.8 85.1c-7.8-7.8-7.8-20.5 0-28.3L63.1 13c5.5-5.5 14.3-5.5 19.8 0s5.5 14.3 0 19.8L38.6 76.7c-3.1 3.1-8.2 3.1-11.3 0-3.1-3.1-3.1-8.2 0-11.3l22.3-21.8c.8-.8 2.1-.8 2.8 0 .8.8.8 2.1 0 2.8L30.2 68.2c-1.5 1.5-1.5 4.1 0 5.6 1.6 1.6 4.1 1.6 5.7 0L80.2 30c3.9-3.9 3.9-10.2 0-14.1-3.9-3.9-10.2-3.9-14.1 0L21.7 59.7c-6.2 6.2-6.2 16.4 0 22.6 6.3 6.2 16.4 6.2 22.6 0l38.3-37.8c.8-.8 2.1-.8 2.8 0 .8.8.8 2.1 0 2.8L47.1 85.2c-7.8 7.7-20.4 7.8-28.3-.1z"},null,-1),z=(0,a._)("path",{fill:"#fff",d:"M664-510v1684h-1784V-510H664m8-8h-1800v1700H672V-518z"},null,-1),W=[N,z],F={id:"bottomPanel",style:{position:"absolute",bottom:"1px",right:"6px",padding:"5px"},class:"px-3"},B=["src"];function R(e,t,N,z,R,O){const P=(0,a.up)("Editor"),J=(0,a.up)("DotDot"),U=(0,a.Q2)("svg-inline");return(0,a.wg)(),(0,a.iD)("div",n,[(0,a._)("div",o,[(0,a._)("div",r,[(0,a._)("h6",c,[(0,a.Uk)((0,i.zw)(R.selectedChatInfo.full_name)+" ",1),R.isTyping?((0,a.wg)(),(0,a.iD)("span",d,"is typing")):(0,a.kq)("",!0)])]),(0,a._)("div",u,[h,(0,a.Wm)(l.W3,{name:"list",tag:"div",class:"chat-container"},{default:(0,a.w5)((()=>[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(R.all_message,((e,t)=>((0,a.wg)(),(0,a.iD)("div",{key:t},[O.shouldRenderDivider(t)?((0,a.wg)(),(0,a.iD)("div",p,[(0,a._)("div",m,[(0,a._)("span",g,(0,i.zw)(O.formatDateAndPreviousDay(e.created_at,t).currentDay),1)])])):(0,a.kq)("",!0),(0,a._)("div",y,[O.shouldRenderImage(t,O.shouldRenderDivider(t))?((0,a.wg)(),(0,a.iD)("div",_,[(0,a._)("img",{class:"image",src:"highSchoolEmployee"!==e.user_type?R.selectedChatInfo.photo_url:R.user.profile_photo_url},null,8,f)])):((0,a.wg)(),(0,a.iD)("div",v)),(0,a._)("div",null,[(0,a._)("div",null,[(0,a._)("div",b,[(0,a._)("b",w,(0,i.zw)(O.getName(e)),1),(0,a._)("span",D,(0,i.zw)(e.time_at),1)]),(0,a._)("p",{style:{"font-size":"14px"},innerHTML:e.message},null,8,x),e.attachement?((0,a.wg)(),(0,a.iD)("p",k,[(0,a._)("img",{src:e.attachement,alt:"attachment"},null,8,q)])):(0,a.kq)("",!0)])])])])))),128))])),_:1})],512)]),(0,a._)("div",T,[(0,a._)("div",{id:"text-container",class:(0,i.C_)(["col-md-8 offset-md-2",{"message-input-container":R.showInput}])},[(0,a._)("div",I,[(0,a._)("div",C,[(0,a._)("div",S,[(0,a.Wm)(P,{ref:"editor",modelValue:R.message,"onUpdate:modelValue":t[1]||(t[1]=e=>R.message=e),onKeyup:O.sendIsTypingEvent,class:"message-editor",editorStyle:"max-height:"+R.editorHeight+"px;width:100%",placeholder:"Type a message"},{toolbar:(0,a.w5)((()=>[(0,a._)("div",E,[$,M,(0,a._)("label",L,[(0,a._)("input",{style:{cursor:"pointer"},type:"file",onChange:t[0]||(t[0]=e=>O.onAdvancedUpload(e)),class:"file-input"},null,32),(0,a._)("span",H,[((0,a.wg)(),(0,a.iD)("svg",A,W))])])])])),_:1},8,["modelValue","onKeyup","editorStyle"]),(0,a._)("div",F,[R.sending?((0,a.wg)(),(0,a.j4)(J,{key:1})):((0,a.wg)(),(0,a.iD)("button",{key:0,onClick:t[2]||(t[2]=(...e)=>O.send&&O.send(...e)),style:{float:"right"},class:"btn btn-success btn-sm py-0"},[(0,a.wy)((0,a._)("img",{style:{width:"26px",fill:"white","pointer-events":"none"},src:s(3971)},null,8,B),[[U]])]))])])])])],2)])])}s(7658);var O=s(708),P=s(9792),J=s.n(P);const U=e=>((0,a.dD)("data-v-564ed8ce"),e=e(),(0,a.Cn)(),e),V={style:{display:"inline-block"}},j=U((()=>(0,a._)("div",{class:"snippet","data-title":"dot-elastic"},[(0,a._)("div",{class:"stage"},[(0,a._)("div",{class:"dot-elastic"})])],-1))),K=[j];function Z(e,t){return(0,a.wg)(),(0,a.iD)("div",V,K)}var Q=s(89);const Y={},G=(0,Q.Z)(Y,[["render",Z],["__scopeId","data-v-564ed8ce"]]);var X=G,ee=s(3564);const te=J()["import"]("formats/link");class se extends te{static create(e){const t=super.create(e);t.setAttribute("target","_blank"),t.setAttribute("rel","noopener noreferrer");const s=e.toLowerCase().split(".").pop();if(["jpg","jpeg","gif","png"].includes(s)){const s=document.createElement("img");s.src=e,s.alt="Image",s.style.width="110px",t.appendChild(s)}else t.innerHTML="&#128196;",t.style.fontSize="4em",t.style.background="repeating-linear-gradient(45deg, black, transparent 100px)",t.style.borderRadius="5px";return t}static formats(e){return{customFile:e.innerHTML}}}se.blotName="customFile",se.tagName="A",J().register(se,!0);const ae={name:"ViewMail",components:{Editor:ee.Z,DotDot:X},data(){return{sending:!1,editorHeight:200,selectedEmails:[],emails:[],all_message:{},selectedChatInfo:{},rotateReload:!1,showToolbar:!1,message:"",showInput:!1,someFiles:[],attchments:[],user:JSON.parse(localStorage.getItem("userInfo")),isTyping:!1,channel:null,Echo:null,uploadUrl:"",customHeaders:{Authorization:"Bearer "+localStorage.getItem("user")}}},async created(){this.updateMessages()},beforeRouteLeave(e,t,s){window.Echo.leave(this.channelName()),s()},mounted(){window.receiverChannel=window.Echo.private(this.channelName()),window.receiverChannel.listen(".new-message",this.handleMessage).listenForWhisper("typing",this.handleIsTyping),this.$nextTick((()=>{setTimeout((()=>{this.toggleToolbar(!1);const e=document.querySelector(".p-editor-toolbar.ql-toolbar.ql-snow"),t=document.querySelector(".p-editor-content.ql-container.ql-snow"),s=document.querySelector("#bottomPanel");e&&t.appendChild(s);const a=document.getElementById("text-container"),i=document.querySelector(".ql-editor"),l=document.querySelector(".outsideEditor");l.addEventListener("click",(()=>{i.style.maxHeight="40px",this.toggleToolbar(!1)})),a.addEventListener("click",(()=>{i.style.maxHeight="150px",this.toggleToolbar(!0)}))}),2e3)}))},methods:{toggleToolbar(e){this.showToolbar=e;const t=document.querySelector(".p-editor-toolbar.ql-toolbar.ql-snow");t.style.display=this.showToolbar?"block":"none"},async onAdvancedUpload(e){const t=e.target.files[0],s=new FormData;s.append("file",t),s.append("folder_name","chatsFiles");const a=await(0,O.nv)("file_upload",s),i=this.$refs.editor.quill,l=i.getSelection(!0);i.format("customFile",a.responseBody),i.setSelection(l.index+1)},channelName(){return`chat.${this.selectedChatInfo.chat_code}`},shouldRenderDivider(e){if(0===e)return!0;{const t=this.formatDateAndPreviousDay(this.all_message[e-1].created_at,e-1).currentDay,s=this.formatDateAndPreviousDay(this.all_message[e].created_at,e).currentDay;return t!==s}},shouldRenderImage(e,t){if(0===e)return!0;{if(t)return!0;const s=this.all_message[e-1].user_type,a=this.all_message[e].user_type;return s!==a}},formatDateAndPreviousDay(e,t){const s=["January","February","March","April","May","June","July","August","September","October","November","December"],a=new Date(e),i=`${this.getDayOfWeek(a)}, ${s[a.getMonth()]} ${this.getDayWithSuffix(a.getDate())}`,l=new Date(a);l.setDate(a.getDate()-t);let n="";return t>0&&(n=`${this.getDayOfWeek(l)}, ${s[l.getMonth()]} ${this.getDayWithSuffix(l.getDate())}`),{currentDay:i,previousDay:n}},getDayOfWeek(e){const t=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];return t[e.getDay()]},getDayWithSuffix(e){if(e>=11&&e<=13)return`${e}th`;switch(e%10){case 1:return`${e}st`;case 2:return`${e}nd`;case 3:return`${e}rd`;default:return`${e}th`}},handleMessage(e){"universityEmployee"!==e.sender_type&&this.all_message.push(e),setTimeout((()=>{this.scrollToBottom()}),50)},async send(){if(""==this.message)return!1;this.sending=!0;const e=await(0,O.v_)("chat/send",{receiver_id:this.selectedChatInfo.sender_id,receiver_type:this.selectedChatInfo.user_type,message:this.message,chat_code:this.selectedChatInfo?.chat_code});e?.message&&("chat closed"==e?.message&&this.$router.push("/chats"),this.all_message.push(e.messageData),this.message=""),this.sending=!1},scrollToBottom(){const e=this.$refs.chatContainer;e&&(e.scrollTop=e?.scrollHeight)},async updateMessages(){this.selectedChatInfo=JSON.parse(localStorage.getItem("chatInfo"));let e=await(0,O.U2)(`chats?chat_code=${this.selectedChatInfo.chat_code}`);return this.all_message=e.message,setTimeout((()=>{this.scrollToBottom()}),50),!0},messageClass(e){return"admin"==e.user_type?"message receiver":"message sender"},sendIsTypingEvent(){window.receiverChannel.whisper("typing",JSON.stringify({typing:!0}))},handleIsTyping(){this.isTyping=!0,setTimeout((()=>{this.isTyping=!1}),4e3)},getName(e){return"universityEmployee"==e.user_type?this.user?.first_name+" "+this.user?.last_name:"admin"==e.user_type?"Paramount Support":this.selectedChatInfo.full_name}}},ie=()=>{(0,l.sj)((e=>({"7cc5b56d":e.selectedChatInfo.user_type})))},le=ae.setup;ae.setup=le?(e,t)=>(ie(),le(e,t)):ie;var ne=ae;const oe=(0,Q.Z)(ne,[["render",R]]);var re=oe},3971:function(e,t,s){e.exports=s.p+"img/send-icon.dfd96d86.svg"}}]);
//# sourceMappingURL=983.d81d272b.js.map