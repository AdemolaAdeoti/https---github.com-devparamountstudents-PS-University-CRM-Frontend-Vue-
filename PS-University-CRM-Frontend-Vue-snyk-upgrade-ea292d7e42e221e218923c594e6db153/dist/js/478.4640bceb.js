"use strict";(self["webpackChunkuniversity_crm"]=self["webpackChunkuniversity_crm"]||[]).push([[478,7613],{478:function(e,t,i){i.r(t),i.d(t,{default:function(){return X}});var a=i(3396),s=i(9242),n=i(7139);const r=e=>((0,a.dD)("data-v-6ee42b42"),e=e(),(0,a.Cn)(),e),l={key:0,class:"pdf-container",style:{overflow:"auto",width:"100%",height:"100vh"}},o={key:0,class:"container d-flex"},d=["innerHTML"],u=r((()=>(0,a._)("span",{style:{fill:"#000","font-weight":"bold","font-size":"1em"}},"T",-1))),g=[u],c={key:1},h=["href"],v={class:"pdf-viewer position-relative"},p={ref:"draggableresizableimage",class:"ui-widget-content",style:{position:"absolute",top:"0px",width:"150px",height:"150px",padding:"0.5em"}},b={ref:"signature",id:"signature",src:"",alt:"",style:{width:"100%",height:"100%"}},m=(0,a.uE)('<div class="l ui-resizable-handle ui-resizable-w resizable-wrapper" id="w" data-v-6ee42b42></div><div class="r ui-resizable-handle ui-resizable-e resizable-wrapper" id="e" data-v-6ee42b42></div><div class="tl ui-resizable-handle ui-resizable-nw" id="nw" data-v-6ee42b42></div><div class="tr ui-resizable-handle ui-resizable-ne" id="ne" data-v-6ee42b42></div><div class="bl ui-resizable-handle ui-resizable-sw" id="sw" data-v-6ee42b42></div><div class="br ui-resizable-handle ui-resizable-se" id="se" data-v-6ee42b42></div>',6),f={ref:"draggableresizableimage2",class:"ui-widget-content",style:{position:"absolute",top:"0px",width:"150px",height:"150px",padding:"0.5em"}},w={style:{width:"160%",display:"flex"}},y=(0,a.uE)('<option value="10" data-v-6ee42b42>10</option><option value="14" data-v-6ee42b42>14</option><option value="16" data-v-6ee42b42>16</option><option value="20" data-v-6ee42b42>20</option><option value="24" data-v-6ee42b42>24</option>',5),x=[y],_=(0,a.uE)('<div class="l ui-resizable-handle ui-resizable-w resizable-wrapper" id="w2" data-v-6ee42b42></div><div class="r ui-resizable-handle ui-resizable-e resizable-wrapper" id="e2" data-v-6ee42b42></div><div class="tl ui-resizable-handle ui-resizable-nw" id="nw2" data-v-6ee42b42></div><div class="tr ui-resizable-handle ui-resizable-ne" id="ne2" data-v-6ee42b42></div><div class="bl ui-resizable-handle ui-resizable-sw" id="sw2" data-v-6ee42b42></div><div class="br ui-resizable-handle ui-resizable-se" id="se2" data-v-6ee42b42></div>',6),S=["onMousemove"],z={key:2},C={class:"modal-custom"},I={class:"modal-header"},k={class:"modal-body"},D={key:1};function P(e,t,i,r,u,y){const P=(0,a.up)("Signature");return u.userInfo.university.agreement_letter?((0,a.wg)(),(0,a.iD)("div",l,[null==u.userInfo.university.agreement_letter.url?((0,a.wg)(),(0,a.iD)("div",o,[(0,a._)("input",{onChange:t[0]||(t[0]=(...e)=>y.handleFileUpload&&y.handleFileUpload(...e)),type:"file",ref:"myFileInput",style:{display:"none"}},null,544),(0,a._)("input",{type:"button",onClick:t[1]||(t[1]=t=>e.$refs["myFileInput"].click()),value:"Choose file"}),(0,a._)("button",{onClick:t[2]||(t[2]=e=>u.showModal=!0),type:"button",class:"ms-2",tite:"Digital Signature"},[(0,a._)("span",{innerHTML:e.$globals.icons.pen,style:{fill:"#000"}},null,8,d)]),(0,a._)("button",{onClick:t[3]||(t[3]=e=>u.showTextFrame=!0),type:"button",class:"ms-2",title:"Add Text"},g),this.canvasIndex>-1?((0,a.wg)(),(0,a.iD)("input",{key:0,type:"button",onClick:t[4]||(t[4]=(...e)=>y.undo&&y.undo(...e)),class:"ms-2",value:"Undo"})):(0,a.kq)("",!0),(0,a._)("input",{type:"button",onClick:t[5]||(t[5]=(...e)=>y.submitSignedPdf&&y.submitSignedPdf(...e)),class:"ms-2",value:"Submit Document"})])):((0,a.wg)(),(0,a.iD)("div",c,[(0,a._)("a",{href:u.userInfo.university.agreement_letter.url,download:"",class:"ms-2 btn btn-secondary"}," Download ",8,h)])),(0,a._)("div",v,[(0,a.wy)((0,a._)("div",p,[(0,a._)("img",b,null,512),m,(0,a._)("button",{onClick:t[6]||(t[6]=(...e)=>y.attachSignature&&y.attachSignature(...e)),class:"position-absolute btn bg-white",style:{color:"rgb(255, 0, 106)",border:"1px solid rgb(255, 0, 106)",left:"0px","white-space":"nowrap",bottom:"-35px"}},"Insert Here")],512),[[s.F8,u.activateSign]]),(0,a.wy)((0,a._)("div",f,[(0,a._)("div",w,[(0,a.wy)((0,a._)("textarea",{rows:"1",cols:"40","onUpdate:modelValue":t[7]||(t[7]=e=>u.text.value=e),style:(0,n.j5)(["font-size:"+u.text.fontSize+"px",{border:"1px solid rgb(255, 0, 106)",background:"transparent"}])},null,4),[[s.nr,u.text.value]]),(0,a.wy)((0,a._)("select",{"onUpdate:modelValue":t[8]||(t[8]=e=>u.text.fontSize=e),style:{width:"50px"},class:"form-control"},x,512),[[s.bM,u.text.fontSize]])]),_,(0,a._)("button",{onClick:t[9]||(t[9]=(...e)=>y.attachText&&y.attachText(...e)),class:"position-absolute btn bg-white",style:{color:"rgb(255, 0, 106)",border:"1px solid rgb(255, 0, 106)",left:"20px","white-space":"nowrap",bottom:"52px"}},"Insert Here")],512),[[s.F8,u.showTextFrame]]),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(u.pdfPages,((e,t)=>((0,a.wg)(),(0,a.iD)("div",{style:{width:"700px"},key:t,class:"page-thumbnail mx-auto",onMousemove:e=>y.handleCanvasClick(t,e)},[(0,a._)("canvas",{ref_for:!0,ref:"pageCanvas_"+t,style:{width:"100%"},height:"200"},null,512)],40,S)))),128))]),u.showModal?((0,a.wg)(),(0,a.iD)("div",z,[(0,a._)("div",{class:"modal-overlay",onClick:t[10]||(t[10]=(...e)=>y.closeModal&&y.closeModal(...e))}),(0,a._)("div",C,[(0,a._)("div",I,[(0,a._)("button",{class:"modal-close",onClick:t[11]||(t[11]=(...e)=>y.closeModal&&y.closeModal(...e))},"X")]),(0,a._)("div",k,[(0,a.Wm)(P,{onGetSign:t[12]||(t[12]=e=>y.importSign(e))})])])])):(0,a.kq)("",!0)])):((0,a.wg)(),(0,a.iD)("div",D," No Letter Found "))}i(6229),i(7330),i(2062),i(7658);var U=i(6133),$=i(8003),L=i(3912),M=i.n(L),F=i(7613),H=i(7387),T=i.n(H),R=(i(1818),i(8895)),A=i(708);const W=T();let O=null;var Y={components:{Signature:F["default"]},data(){return{pdfData:null,pdfUrl:null,pdfPages:[],signaturePosition:null,selectedPage:"",showModal:!1,activateSign:!1,showTextFrame:!1,text:{value:"Your text here",fontSize:14,x:0,y:0,w:0,h:0},sign:{x:0,y:0,w:0,h:0,file:null},pdfScale:3,userInfo:JSON.parse(localStorage.getItem("userInfo")||"{}"),canvasHistory:[],canvasIndex:-1}},methods:{async handleCanvasClick(e){this.selectedPage=e},handleFileUpload(e){const t=e.target.files[0];t&&(this.$refs.signature.src=URL.createObjectURL(t),this.sign.file=URL.createObjectURL(t),this.activateSign=!0,this.sign.w=100,this.sign.h=100)},importSign(e){this.$refs["signature"].src=e,this.sign.w=100,this.sign.h=100,this.sign.file=e,this.showModal=!1,this.activateSign=!0},closeModal(){this.showModal=!1,this.doc=""},async loadPdf(){this.pdfUrl=null!=this.userInfo.university.agreement_letter.url?this.userInfo.university.agreement_letter.url:this.userInfo.university.agreement_letter.template,this.pdfUrl=this.pdfUrl||"";try{$.GlobalWorkerOptions.workerSrc=M();const e=$.getDocument({url:this.pdfUrl});O=await e.promise,this.pdfPages=Array.from({length:O.numPages},((e,t)=>O.getPage(t+1)))}catch(e){console.log(e)}},async attachText(){const e=this.$refs["pageCanvas_"+this.selectedPage][0],t=e.getContext("2d"),i=e.toDataURL();this.canvasHistory.push(i),this.canvasIndex=this.canvasHistory.length-1;const a=this.text.value,s=this.text.fontSize,n=2.8*s+"px Arial",r=this.pdfScale-.5,l=this.text.x*r+45,o=this.text.y*r+45;t.font=n,t.fillStyle="black",t.fillText(a,l,o),this.showTextFrame=!1},async attachSignature(){const e=this.$refs["pageCanvas_"+this.selectedPage][0],t=e.toDataURL();this.canvasHistory.push(t),this.canvasIndex=this.canvasHistory.length-1;var i=e.getContext("2d");const a=new Image;a.src=this.sign.file,await new Promise((e=>a.onload=e));const s=a.width,n=a.height,r=this.pdfScale-.5,l=this.sign.x*r,o=this.sign.y*(this.pdfScale-.2),d=this.sign.w*r,u=this.sign.h*r,g=0,c=0;i.drawImage(this.$refs.signature,0,0,s,n,l-c,o+g,d,u),this.activateSign=!1},undo(){if(this.canvasIndex>-1){const e=this.canvasHistory[this.canvasIndex];this.canvasIndex-=1;const t=this.$refs["pageCanvas_"+this.selectedPage][0],i=t.getContext("2d"),a=new Image;a.onload=()=>{i.clearRect(0,0,t.width,t.height),i.drawImage(a,0,0)},a.src=e}},async submitSignedPdf(){if(!this.sign.file)return void(0,R.K)({text:"Please select a signature."});const e=595,t=842,i=await U.PDFDocument.create();for(let u=0;u<this.pdfPages.length;u++){const a=this.$refs["pageCanvas_"+u][0],s=a.toDataURL("image/png"),n=await i.embedPng(s),r=i.addPage([e,t]);r.drawImage(n,{x:0,y:0,width:e,height:t})}$.GlobalWorkerOptions.workerSrc=M();const a=await i.save(),s=new Blob([a],{type:"application/pdf"}),n=new FormData;n.append("file",s),n.append("folder_name","AgreementLetters");let r=await(0,A.nv)("file_upload",n,!0);const l=this.userInfo,o=r.responseBody;this.userInfo.university.agreement_letter.url=o;let d=await(0,A.v_)("sign_agreement",{id:l.university.id,platform:"university",url:o},!0);d?.message&&(console.log(this.userInfo.university),localStorage.removeItem("userInfo"),localStorage.setItem("userInfo",JSON.stringify(this.userInfo)),(0,R.K)({text:"Signature added to PDF and PDF saved."}))}},async created(){if(this.userInfo.university.agreement_letter)try{await this.loadPdf(),$.GlobalWorkerOptions.workerSrc=M(),Array.from({length:O.numPages},((e,t)=>O.getPage(t+1).then((async e=>{const i=this.$refs["pageCanvas_"+t][0],a=i.getContext("2d"),s=e.getViewport({scale:this.pdfScale});i.height=s.height,i.width=s.width,await e.render({canvasContext:a,viewport:s,enableWebGL:!1})}))))}catch(e){this.userInfo.university.agreement_letter=null,(0,R.K)({text:"Agreement let yet to be sent"})}},mounted(){this.$nextTick((()=>{W(this.$refs.draggableresizableimage).resizable({handles:{nw:".tl",ne:".tr",sw:".bl",se:".br",e:".r",w:".l"},minHeight:70,minWidth:100,autoHide:!0,stop:(e,t)=>{this.sign.w=t.size.width,this.sign.h=t.size.height}}),W(this.$refs.draggableresizableimage2).resizable({handles:{nw:".tl",ne:".tr",sw:".bl",se:".br",e:".r",w:".l"},minHeight:70,minWidth:100,autoHide:!0,stop:(e,t)=>{this.text.fontSize=t.size.height}}),W(this.$refs.draggableresizableimage).draggable({stop:(e,t)=>{const i=this.$refs["pageCanvas_"+this.selectedPage][0],a=W(i).position(),s=a.left,n=a.top;this.sign.x=t.position.left-s,this.sign.y=t.position.top-n}}),W(this.$refs.draggableresizableimage2).draggable({stop:(e,t)=>{const i=this.$refs["pageCanvas_"+this.selectedPage][0],a=W(i).position(),s=a.left,n=a.top;this.text.x=t.position.left-s,this.text.y=t.position.top-n}})}))}},B=i(89);const E=(0,B.Z)(Y,[["render",P],["__scopeId","data-v-6ee42b42"]]);var X=E},7613:function(e,t,i){i.r(t),i.d(t,{default:function(){return z}});var a=i(3396);const s={class:"px-3 row"},n={class:"offset-md-2 col-md-8"},r={class:"d-flex mb-3 row"},l={class:"col-md-6"},o=(0,a._)("h4",null,"Sign Here",-1),d={id:"parentDiv",class:"border",ref:"signatureCanvas",width:"100%",height:"200"},u={class:"col-md-6 mb-3"},g=(0,a._)("h4",null,"Output",-1),c={class:"border",style:{width:"100%",height:"200px"}},h={ref:"signature",src:"",alt:""},v=(0,a._)("div",{class:"col-md-2"},null,-1),p={class:"col-md-12"};function b(e,t,i,b,m,f){const w=(0,a.up)("center");return(0,a.wg)(),(0,a.iD)("div",s,[(0,a._)("div",n,[(0,a._)("div",r,[(0,a._)("div",l,[o,(0,a._)("div",d,null,512)]),(0,a._)("div",u,[g,(0,a._)("div",c,[(0,a._)("img",h,null,512)])])]),(0,a._)("button",{class:"btn btn-sm d-inline-block mx-1 btn-warning",onClick:t[0]||(t[0]=(...e)=>f.clearSignature&&f.clearSignature(...e))}," Clear "),(0,a._)("button",{class:"btn btn-sm d-inline-block mx-1 btn-warning",onClick:t[1]||(t[1]=(...e)=>f.captureSignature&&f.captureSignature(...e))}," Capture Signature ")]),v,(0,a._)("div",p,[(0,a.Wm)(w,null,{default:(0,a.w5)((()=>[(0,a._)("button",{onClick:t[2]||(t[2]=(...e)=>f.useSignature&&f.useSignature(...e)),class:"btn mx-auto d-inline btn-warning mt-5"},"Use Signature")])),_:1})])])}var m=i(8851),f=i.n(m),w=i(5220),y=null,x={name:"signatureView",data(){return{store:(0,w.L)(),signUrl:null}},methods:{useSignature(){this.$emit("getSign",this.signUrl)},initializeCanvas(){y=new(f())(this.drawSignature,this.$refs.signatureCanvas)},drawSignature(e){let t=!1,i=0,a=0;e.setup=()=>{const t=document.getElementById("parentDiv");e.createCanvas(t.clientWidth,200),e.frameRate(3),e.strokeWeight(2),e.noFill(),e.background(255)},e.mousePressed=()=>{t=!0,i=e.mouseX,a=e.mouseY},e.mouseReleased=()=>{t=!1},e.touchMoved=()=>(e.line(e.mouseX,e.mouseY,i,a),i=e.mouseX,a=e.mouseY,!1),e.draw=()=>{if(t)return e.line(i,a,e.mouseX,e.mouseY),i=e.mouseX,a=e.mouseY,!1}},clearSignature(){y.clear(),y.background(255)},getSignatureData(){return this.$refs.signatureCanvas.toDataURL()},captureSignature(){const e=new Image;e.crossOrigin="Anonymous",this.store.isLoading=!0;const t=this.$refs.signatureCanvas.getElementsByTagName("canvas")[0],i=t.getContext("2d");e.onload=()=>{t.width=e.width,t.height=e.height,i.drawImage(e,0,0);const a=this.removeImageBlanks(t);console.log("Cropped Image Data:",a),this.$refs.signature.src=a,this.signUrl=a,this.store.isLoading=!1},e.src=t.toDataURL()},removeImageBlanks(e){let t=e.width,i=e.height;var a=document.createElement("canvas");a.setAttribute("width",t),a.setAttribute("height",i);var s=a.getContext("2d");s.drawImage(e,0,0);var n=s.getImageData(0,0,t,i),r=n.data,l=function(e,i){var a=t*i+e;return{red:r[4*a],green:r[4*a+1],blue:r[4*a+2],opacity:r[4*a+3]}},o=function(e){return e.red>200&&e.green>200&&e.blue>200},d=function(e){for(var a=e?1:-1,s=e?0:i-1;e?s<i:s>-1;s+=a)for(var n=0;n<t;n++){var r=l(n,s);if(!o(r))return e?s:Math.min(s+1,i)}return null},u=function(e){for(var a=e?1:-1,s=e?0:t-1;e?s<t:s>-1;s+=a)for(var n=0;n<i;n++){var r=l(s,n);if(!o(r))return e?s:Math.min(s+1,t)}return null},g=d(!0),c=d(!1),h=u(!0),v=u(!1),p=v-h,b=c-g;return a.setAttribute("width",p),a.setAttribute("height",b),a.getContext("2d").drawImage(e,h,g,p,b,0,0,.5*p,.5*b),a.toDataURL()}},mounted(){this.initializeCanvas()}},_=i(89);const S=(0,_.Z)(x,[["render",b]]);var z=S}}]);
//# sourceMappingURL=478.4640bceb.js.map